<?php

namespace PhpWinTools\WmiScripting\Containers;

use PhpWinTools\WmiScripting\Connections\ComConnection;
use PhpWinTools\WmiScripting\Configuration\Config;

class Connections extends Container
{
    public function __construct(Config $config)
    {
        $items = [];

        foreach ($config->get('wmi.connections.servers') as $key => $value) {
            $items[$key] = new ComConnection(
                $value['server'] ?? ComConnection::DEFAULT_SERVER,
                $value['namespace'] ?? ComConnection::DEFAULT_NAMESPACE,
                $value['user'] ?? null,
                $value['password'] ?? null,
                $value['locale'] ?? null,
                $value['authority'] ?? null,
                $value['security_flags'] ?? null
            );
        }

        parent::__construct($items);
    }

    public function set($key, ComConnection $connection)
    {
        $this->offsetSet($key, $connection);

        return $this;
    }

    /**
     * @param string                $key
     * @param mixed|ComConnection|null $default
     *
     * @return ComConnection|null
     */
    public function get($key, $default = null)
    {
        return parent::get($key, $default); // TODO: Change the autogenerated stub
    }
}
